# Trivy Configuration for {{ project_name }}
# Generated by validation-framework
# Documentation: https://aquasecurity.github.io/trivy/

# Scan configuration
scan:
  # Scan types: vuln, secret, misconfig, license
  scanners:
{%- for scan_type in scan_types | default(['vuln', 'secret']) %}
    - {{ scan_type }}
{%- endfor %}

  # Security checks (for misconfig scanner)
  security-checks:
    - vuln
    - secret
{%- if 'misconfig' in (scan_types | default(['vuln', 'secret'])) %}
    - config
{%- endif %}

# Vulnerability settings
vulnerability:
  # Severity filter: UNKNOWN, LOW, MEDIUM, HIGH, CRITICAL
  severity: {{ severity | default('CRITICAL,HIGH') }}

  # Ignore unfixed vulnerabilities
  ignore-unfixed: {{ ignore_unfixed | default(true) | lower }}

  # Vulnerability types to scan
  type:
    - os
    - library

# Secret scanning settings
secret:
  # Enable secret scanning
  enable: {{ 'secret' in (scan_types | default(['vuln', 'secret'])) | lower }}

# Misconfiguration settings
misconfig:
  # Enable misconfiguration scanning
  enable: {{ 'misconfig' in (scan_types | default(['vuln', 'secret'])) | lower }}

  # Include non-public files
  include-non-failures: false

# Output configuration
output:
  # Format: table, json, sarif, template, cyclonedx, spdx
  format: sarif

  # Output file path (set by CI workflow)
  # output: trivy-results.sarif

# Cache settings
cache:
  # Cache directory
  dir: .trivy-cache

  # Cache backend: fs, redis
  backend: fs

# Database settings
db:
  # Skip database update (use cached)
  skip-update: false

  # Download database only
  download-only: false

# Image settings (for container scanning)
image:
  # Image reference pattern
  ref: {{ image_name | default('app') }}:{% raw %}${{ github.sha }}{% endraw %}

  # Remove the image after scanning
  remove-fstree: true

  # Input sources: archive, remote
  input: []

# File patterns to scan
filesystem:
  # Root directory for filesystem scan
  root: .

  # Skip directories
  skip-dirs:
    - node_modules
    - .git
    - vendor
    - __pycache__
    - .venv
    - venv

# Exit codes
exit:
  # Exit with 1 if vulnerabilities found (CRITICAL for PR blocking)
  code: 1

  # Return exit code only on specific severity
  on-severity: {{ severity | default('CRITICAL,HIGH') }}

# Timeout for the scan
timeout: 10m

# Ignore file
ignorefile: .trivyignore

# Clear cache before scanning
clear-cache: false

# Debug mode
debug: false

# Quiet mode (suppress progress bar)
quiet: true
