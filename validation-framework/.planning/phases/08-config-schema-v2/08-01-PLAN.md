---
phase: 08-config-schema-v2
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.claude/templates/validation/scaffold.sh
  - ~/.claude/templates/validation/config_loader.py
autonomous: true
domain: validation-framework
---

<objective>
Enhance config generation tooling to expose all 14 dimensions with sensible defaults.

Purpose: The schema v2 exists but scaffold.sh only generates basic config without dimensions. Extend existing config_loader.py to provide generation capabilities, then update scaffold.sh to use it.

Output:
- Extended config_loader.py with --generate and --domain flags
- Enhanced scaffold.sh that delegates to Python for dimension generation
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source files to modify
@~/.claude/templates/validation/scaffold.sh
@~/.claude/templates/validation/config_loader.py
@~/.claude/templates/validation/config.schema.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend config_loader.py with generation CLI</name>
  <files>~/.claude/templates/validation/config_loader.py</files>
  <action>
Extend the existing CLI in config_loader.py to support config generation.

Add new CLI flags:
1. `--generate` - Generate new config to stdout or file
2. `--domain {trading|workflow|data|general}` - Select domain preset
3. `--project-name NAME` - Set project name (required with --generate)
4. `--output PATH` - Write to file instead of stdout

Domain presets (use existing DEFAULT_DIMENSIONS as base):
- trading: coverage.min_percent=80, security strict, k8s.enabled=true
- workflow: coverage.min_percent=60, performance budgets relaxed
- data: data_integrity.enabled=true, api_contract.enabled=true
- general: DEFAULT_DIMENSIONS as-is

CLI interface:
```bash
# Generate trading config
python config_loader.py --generate --domain trading --project-name nautilus

# Generate to file
python config_loader.py --generate --domain data --project-name myproj --output config.json

# Existing commands still work
python config_loader.py --validate config.json
python config_loader.py --show-defaults
python config_loader.py --show-merged config.json
```

Implementation:
1. Add DOMAIN_PRESETS dict with domain-specific overrides
2. Add generate_config(project_name, domain) function
3. Extend argparse with new flags
4. Output valid JSON with $schema reference

Keep it simple - reuse existing DEFAULT_DIMENSIONS and merge_configs().
  </action>
  <verify>
Run: `python ~/.claude/templates/validation/config_loader.py --generate --domain trading --project-name test-proj`
Verify: Output is valid JSON with 14 dimensions and trading-specific values (coverage.min_percent=80)
  </verify>
  <done>
- config_loader.py --generate works
- --domain selects correct preset
- Output JSON validates against schema
  </done>
</task>

<task type="auto">
  <name>Task 2: Update scaffold.sh to use Python generator</name>
  <files>~/.claude/templates/validation/scaffold.sh</files>
  <action>
Simplify scaffold.sh by delegating config generation to config_loader.py.

Changes:
1. Remove inline JSON generation for dimensions (error-prone bash)
2. Call Python to generate full config:
   ```bash
   python3 "$SCRIPT_DIR/config_loader.py" \
     --generate \
     --domain "$DOMAIN" \
     --project-name "$PROJECT_NAME" \
     --output "$PROJECT_PATH/.claude/validation/config.json"
   ```

3. Keep smoke test template copying logic unchanged
4. Keep domain extension copying logic unchanged
5. Add fallback for systems without Python (copy template config)

Structure:
```bash
# Generate config via Python (full v2 with dimensions)
if command -v python3 &>/dev/null; then
  python3 "$SCRIPT_DIR/config_loader.py" \
    --generate --domain "$DOMAIN" \
    --project-name "$PROJECT_NAME" \
    --output "$CONFIG_PATH"
else
  echo "Warning: Python3 not found. Copying template config."
  cp "$SCRIPT_DIR/templates/config-template.json" "$CONFIG_PATH"
  # Sed to replace project_name and domain
fi
```

Remove the large heredoc with domain-specific JSON - Python handles this now.
  </action>
  <verify>
Run: `bash ~/.claude/templates/validation/scaffold.sh /tmp/test-scaffold trading`
Verify:
- /tmp/test-scaffold/.claude/validation/config.json exists
- Contains "dimensions" with 14 entries
- coverage.min_percent is 80 (trading preset)
  </verify>
  <done>
- scaffold.sh delegates to Python for config generation
- Generated config has full dimensions section
- Domain presets correctly applied
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python config_loader.py --generate --domain trading --project-name x` outputs valid JSON
- [ ] `python config_loader.py --generate --domain workflow --project-name x` has coverage=60%
- [ ] `python config_loader.py --validate <(python config_loader.py --generate --domain data --project-name x)` passes
- [ ] `bash scaffold.sh /tmp/test trading` creates config with 14 dimensions
- [ ] No new Python files created (extended existing config_loader.py)
</verification>

<success_criteria>

- All tasks completed
- config_loader.py has --generate capability
- scaffold.sh uses Python for config generation
- Generated configs validate against schema
- Zero code duplication (single SSOT in config_loader.py)
</success_criteria>

<output>
After completion, create `.planning/phases/08-config-schema-v2/08-01-SUMMARY.md`
</output>
