# Phase 14.5 Research: claude-hooks-shared Port to Node.js

**Date:** 2026-01-24
**Status:** Complete

## Cross-Check Analysis: ECC vs claude-hooks-shared

### ECC Hooks (5 total, 333 LOC)

| Hook | LOC | Function |
|------|-----|----------|
| session-start.js | 61 | Session files, learned skills, PM detection |
| session-end.js | 83 | Session file template |
| pre-compact.js | 49 | Compaction logging |
| suggest-compact.js | 61 | Tool call tracking, compact suggestions |
| evaluate-session.js | 79 | Message counting, pattern extraction signal |

### claude-hooks-shared (57 Python hooks, 13,933 LOC)

#### core/ (6 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| context_bundle_builder.py | 245 | Build context bundles for session | HIGH |
| context-preservation.py | 161 | Context % tracking, delegation suggestions | HIGH |
| post-tool-use.py | 312 | Post-tool validation orchestration | CRITICAL |
| mcp_client.py | 189 | MCP integration utilities | HIGH |
| run_safe.py | 87 | Safe execution wrapper | MEDIUM |
| safe_hook_wrapper.py | 124 | Error-resilient hook wrapper | MEDIUM |

#### safety/ (4 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| git-safety-check.py | 198 | Prevent destructive git ops | CRITICAL |
| smart-safety-check.py | 267 | Multi-pattern safety validation | CRITICAL |
| port-conflict-check.py | 89 | Port availability check | HIGH |
| ci-batch-check.py | 156 | CI batch operation guard | HIGH |

#### quality/ (7 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| ci-autofix.py | 312 | Auto-fix CI failures | HIGH |
| plan_validator.py | 189 | GSD plan validation | HIGH |
| pr-readiness-check.py | 234 | PR quality gates | HIGH |
| pr-merge-readiness.py | 178 | Merge readiness check | MEDIUM |
| post-commit-quality.py | 145 | Post-commit quality scan | MEDIUM |
| sentry-error-context.py | 167 | Sentry error injection | MEDIUM |
| claudeflow-health.py | 123 | claude-flow health check | MEDIUM |

#### productivity/ (10 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| architecture-validator.py | 289 | ARCHITECTURE.md validation | HIGH |
| readme-generator.py | 234 | README.md generation | HIGH |
| auto-format.py | 156 | Auto-format code | HIGH |
| auto-simplify-check.py | 178 | Code simplification check | MEDIUM |
| tdd-guard-check.py | 201 | TDD compliance check | MEDIUM |
| task-auto-checkpoint.py | 167 | Task progress checkpoint | MEDIUM |
| task-classifier-v2.py | 234 | Task classification | MEDIUM |
| grafana-visual-validator.py | 312 | Grafana visual validation | LOW |
| repo-health-notify.py | 134 | Repo health notifications | LOW |

#### intelligence/ (8 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| session_start_tracker.py | 296 | Git state tracking at start | HIGH |
| session_analyzer.py | 456 | Session metrics, suggestions | HIGH |
| meta_learning.py | 312 | Pattern extraction, SONA | HIGH |
| lesson_injector.py | 245 | Inject learned lessons | HIGH |
| ci_status_injector.py | 189 | CI status context | MEDIUM |
| framework-detector.py | 134 | Tech stack detection | MEDIUM |
| strategy_router.py | 201 | Strategy-based routing | MEDIUM |
| trajectory_tracker.py | 178 | Trajectory tracking | MEDIUM |

#### metrics/ (4 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| dora-tracker.py | 234 | DORA metrics | HIGH |
| quality-score-tracker.py | 267 | Quality score tracking | HIGH |
| claudeflow-sync.py | 189 | claude-flow state sync | HIGH |
| agent-spawn-tracker.py | 145 | Agent spawn metrics | MEDIUM |

#### coordination/ (6 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| file_claim.py | 167 | File locking for multi-agent | HIGH |
| file_release.py | 89 | File release | HIGH |
| task_claim.py | 178 | Task claiming | HIGH |
| task_release.py | 98 | Task release | HIGH |
| stuck_detector.py | 234 | Stuck agent detection | MEDIUM |
| claims_dashboard.py | 156 | Claims dashboard | LOW |

#### session/ (4 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| session_checkpoint.py | 189 | Session state checkpoint | HIGH |
| session_restore_check.py | 145 | Session restore validation | HIGH |
| ssot_check.py | 123 | SSOT consistency check | MEDIUM |
| ralph-resume.py | 178 | Ralph mode resume | MEDIUM |

#### ux/ (6 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| session_insights_writer.py | 110 | SSOT insights aggregation | HIGH |
| tips-auto-inject.py | 234 | Tips injection | HIGH |
| session-summary.py | 189 | Session summary generation | MEDIUM |
| notification.py | 145 | Desktop notifications | LOW |
| stop.py | 98 | Stop hook handler | MEDIUM |
| verbalized_sampling.py | 167 | Verbalized sampling | LOW |

#### control/ (2 hooks)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| ralph-loop.py | 345 | Ralph iterative mode | HIGH |
| auto-ralph.py | 234 | Auto-Ralph detection | MEDIUM |

#### swarm/ (1 hook)
| Hook | LOC | Function | Priority |
|------|-----|----------|----------|
| hive_manager.py | 289 | Multi-agent coordination | HIGH |

## Duplication Analysis

| Functionality | ECC | Ours | Winner | Action |
|--------------|-----|------|--------|--------|
| Session start context | session-start.js | session_start_tracker.py | **Ours** | Port ours + merge PM detection from ECC |
| Session end | session-end.js | session_analyzer.py + session_insights_writer.py | **Ours** | Port ours only |
| Pre-compact | pre-compact.js | context-preservation.py | **Ours** | Port ours only |
| Compact suggestion | suggest-compact.js | *none* | **ECC** | Already ported in Phase 14 |
| Pattern learning | evaluate-session.js | meta_learning.py | **Ours** | Port ours only |

## Priority Grouping for Phase 14.5

### Wave 1: Core & Safety (CRITICAL)
- post-tool-use.py → post-tool-use.js
- git-safety-check.py → git-safety-check.js
- smart-safety-check.py → smart-safety-check.js
- mcp_client.py → mcp-client.js

### Wave 2: Intelligence & Session
- session_start_tracker.py → session-start-tracker.js (merge with ECC PM detection)
- session_analyzer.py → session-analyzer.js
- session_insights_writer.py → session-insights-writer.js
- meta_learning.py → meta-learning.js
- lesson_injector.py → lesson-injector.js

### Wave 3: Quality & Productivity
- architecture-validator.py → architecture-validator.js
- readme-generator.py → readme-generator.js
- ci-autofix.py → ci-autofix.js
- plan_validator.py → plan-validator.js
- auto-format.py → auto-format.js

### Wave 4: Metrics & Coordination
- dora-tracker.py → dora-tracker.js
- quality-score-tracker.py → quality-score-tracker.js
- claudeflow-sync.py → claudeflow-sync.js
- file_claim.py / file_release.py → file-coordination.js
- task_claim.py / task_release.py → task-coordination.js

### Wave 5: UX & Control
- tips-auto-inject.py → tips-injector.js
- ralph-loop.py → ralph-loop.js
- hive_manager.py → hive-manager.js

## Scripts to Port

From `/media/sam/1TB/claude-hooks-shared/scripts/`:

| Script | LOC | Function | Priority |
|--------|-----|----------|----------|
| project_utils.py | 234 | Project utilities | HIGH |
| tips_engine.py | 312 | Tips generation engine | HIGH |
| questdb_client.py | 189 | QuestDB integration | HIGH |
| questdb_metrics.py | 167 | Metrics export | HIGH |
| statistical_analyzer.py | 289 | Statistical analysis | MEDIUM |
| hook_health.py | 145 | Hook health monitoring | MEDIUM |
| heartbeat.py | 98 | Heartbeat monitoring | MEDIUM |
| context-monitor.py | 178 | Context monitoring | MEDIUM |
| secrets_loader.py | 134 | Secrets loading | LOW |
| repo_compliance.py | 156 | Repo compliance check | LOW |

## Node.js Library Structure

```
~/.claude/scripts/
├── lib/
│   ├── utils.js           # Already done (Phase 14)
│   ├── package-manager.js # Already done (Phase 14)
│   ├── mcp-client.js      # NEW: MCP integration
│   ├── git-utils.js       # NEW: Git operations
│   ├── metrics.js         # NEW: Metrics/QuestDB
│   └── tips-engine.js     # NEW: Tips generation
└── hooks/
    ├── core/
    ├── safety/
    ├── quality/
    ├── productivity/
    ├── intelligence/
    ├── metrics/
    ├── coordination/
    ├── session/
    ├── ux/
    └── control/
```

## Estimated Effort

| Plan | Hooks | Est. LOC | Priority |
|------|-------|----------|----------|
| 14.5-01: Core libs | 4 | ~800 | CRITICAL |
| 14.5-02: Safety hooks | 4 | ~600 | CRITICAL |
| 14.5-03: Intelligence hooks | 5 | ~1200 | HIGH |
| 14.5-04: Quality hooks | 5 | ~900 | HIGH |
| 14.5-05: Productivity hooks | 5 | ~800 | MEDIUM |
| 14.5-06: Metrics & Coord | 6 | ~700 | MEDIUM |
| 14.5-07: UX & Control | 5 | ~600 | LOW |
| **Total** | **34** | **~5600** | |

## Key Decisions

1. **Merge, don't duplicate**: Where ECC and ours overlap, merge the best features
2. **Node.js for all**: Convert Python to Node.js for cross-platform consistency
3. **Maintain folder structure**: Mirror Python folder organization in Node.js
4. **Shared libs first**: Create shared libraries before individual hooks
5. **Test as we go**: Each plan includes tests
