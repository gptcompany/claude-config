# Plan 01-01: JSON Schema and Scaffold Script

**Phase**: 1 - Core Framework
**Requirements**: CORE-01, CORE-02, CORE-03
**Status**: Ready

---

## Objective

Create the foundational JSON Schema for validation config and the scaffold script for one-command project initialization.

## Discovery Notes

**Existing Resources:**
- `~/.claude/templates/validation-config.json` — Basic config for spec-pipeline (different purpose, can reference structure)
- `~/.claude/templates/workflows/` — Reference patterns for workflow templates
- `/media/sam/1TB/nautilus_dev/.github/workflows/ci-cd-pipeline.yml` — 6-stage pipeline, reference for smoke integration

**Key Insight:** The existing `validation-config.json` is for spec-pipeline validation (anti-patterns, research keywords). Our new schema is for **pipeline validation config** (smoke tests, K8s, rollback triggers). Different purposes, complementary systems.

---

## Tasks

### T01: Create config.schema.json (CORE-01)

**File**: `~/.claude/templates/validation/config.schema.json`

JSON Schema defining:
- `project_name` (string, required)
- `domain` (enum: trading, workflow, data, general)
- `smoke_tests` object:
  - `critical_imports` (array of import paths)
  - `config_files` (array of config file paths)
  - `external_services` (array of service endpoints)
- `k8s` object (optional):
  - `enabled` (boolean)
  - `namespace` (string)
  - `rollout_strategy` (enum: canary, blue-green, rolling)
- `rollback_triggers` (array of trigger objects):
  - `metric` (string)
  - `threshold` (number)
  - `operator` (enum: <, >, ==, !=)

**Acceptance Criteria:**
- [ ] Schema validates all required fields
- [ ] Provides enums for domain types and operators
- [ ] IDE autocomplete works with $schema reference

### T02: Create scaffold.sh (CORE-02)

**File**: `~/.claude/templates/validation/scaffold.sh`

Bash script that:
1. Takes project path and optional domain as arguments
2. Creates `.claude/validation/` directory structure
3. Generates `config.json` from schema defaults
4. Copies smoke test templates (renders with jinja2 if available)
5. Copies domain-specific extensions if exist
6. Prints next steps

**Acceptance Criteria:**
- [ ] `scaffold.sh /path/to/project [domain]` creates complete structure
- [ ] Supports all domain types: trading, workflow, data, general
- [ ] Generates valid config.json with defaults
- [ ] Renders Jinja2 templates if jinja2-cli available
- [ ] Fallback to raw template copy if jinja2 unavailable

### T03: Create README.md (CORE-03)

**File**: `~/.claude/templates/validation/README.md`

Documentation covering:
- Quick start (scaffold command)
- Config schema reference
- Domain extensions overview
- Template customization guide
- CI workflow integration

**Acceptance Criteria:**
- [ ] Complete usage guide
- [ ] Config schema documented
- [ ] Examples for each domain

---

## Implementation Order

1. T01 (schema) — Foundation for all config
2. T02 (scaffold) — Uses schema, creates structure
3. T03 (README) — Documents everything

## Files Created

```
~/.claude/templates/validation/
├── config.schema.json    [T01]
├── scaffold.sh           [T02]
└── README.md             [T03]
```

## Verification

```bash
# Verify schema
python -c "import json; json.load(open('$HOME/.claude/templates/validation/config.schema.json'))"

# Test scaffold on temp directory
~/.claude/templates/validation/scaffold.sh /tmp/test-validation trading
tree /tmp/test-validation/.claude/
cat /tmp/test-validation/.claude/validation/config.json

# Cleanup
rm -rf /tmp/test-validation
```

---

## Dependencies

- None (first plan in phase)

## Blocked By

- Nothing

## Blocks

- Plan 01-02 (smoke templates need scaffold structure)
