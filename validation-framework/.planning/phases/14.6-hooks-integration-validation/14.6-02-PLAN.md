---
phase: 14.6-hooks-integration-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [~/.claude/scripts/hooks/regression/phase13-compat.test.js, ~/.claude/scripts/hooks/regression/phase14-compat.test.js, ~/.claude/scripts/hooks/regression/upgrade-path.test.js, ~/.claude/scripts/hooks/regression/forward-compat.test.js]
autonomous: true
---

<objective>
Regression tests ensuring backward/forward compatibility with Phase 13, 14, and future Phase 15.

Purpose: Guarantee hooks don't break existing functionality and are designed for extensibility.
Output: 4 test files with ~59 tests covering compatibility guarantees.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-ecc-integration/13-03-SUMMARY.md
@.planning/phases/14-hooks-nodejs-port/14-05-SUMMARY.md
@.planning/phases/14.5-hooks-shared-port/14.5-01-SUMMARY.md

# Existing hooks and libs
# ~/.claude/hooks/hooks.json
# ~/.claude/scripts/lib/*.js
# ~/.claude/scripts/hooks/*/*.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Phase 13 Compatibility Tests</name>
  <files>~/.claude/scripts/hooks/regression/phase13-compat.test.js</files>
  <action>
Create Phase 13 (ECC Integration) compatibility tests (~15 tests):

**Test scenarios:**
1. `/validate skill still works` (5 tests)
   - Verify /validate skill definition unchanged
   - Verify orchestrator run_from_cli works
   - Verify tier filtering (1, 2, 3, all) works
   - Verify exit codes (0=pass, 1=fail, 2=error)
   - Verify ASCII output format preserved

2. `ECC validators registered` (5 tests)
   - Verify ECCValidatorBase importable
   - Verify validators/ecc/ structure intact
   - Verify graceful fallback when ECC unavailable
   - Verify ECC_VALIDATORS_AVAILABLE flag works
   - Verify no import errors

3. `ValidationOrchestrator API unchanged` (5 tests)
   - Verify run() method signature
   - Verify get_results() works
   - Verify 14-dimension registration
   - Verify VALIDATOR_REGISTRY structure
   - Verify report generation

Use subprocess to call Python orchestrator where needed.
  </action>
  <verify>node --test ~/.claude/scripts/hooks/regression/phase13-compat.test.js passes</verify>
  <done>15 Phase 13 compatibility tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Phase 14 Compatibility Tests</name>
  <files>~/.claude/scripts/hooks/regression/phase14-compat.test.js</files>
  <action>
Create Phase 14 (ECC Hooks Port) compatibility tests (~15 tests):

**Test scenarios:**
1. `hooks.json structure valid` (5 tests)
   - Verify hooks.json loads without error
   - Verify all hooks have required fields (matcher, hooks, description)
   - Verify matchers are valid expressions
   - Verify _debug section exists
   - Verify _meta section with version

2. `shared libraries work` (5 tests)
   - utils.js exports all functions
   - package-manager.js detects managers
   - session-start/end hooks run
   - evaluate-session produces output
   - suggest-compact triggers appropriately

3. `test infrastructure intact` (5 tests)
   - test-all-hooks.js runs
   - Pass rate >= 95%
   - All categories tested (EXISTENCE, SYNTAX, BEHAVIOR)
   - Results parseable
   - No new failures from Phase 14

Verify no regression from Phase 14 baseline (99% pass rate).
  </action>
  <verify>node --test ~/.claude/scripts/hooks/regression/phase14-compat.test.js passes</verify>
  <done>15 Phase 14 compatibility tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Upgrade Path Tests</name>
  <files>~/.claude/scripts/hooks/regression/upgrade-path.test.js</files>
  <action>
Create upgrade path tests (~14 tests):

**Test scenarios:**
1. `fresh install works` (4 tests)
   - Create clean ~/.claude/ directory (in temp)
   - Copy hooks infrastructure
   - Verify hooks.json loads
   - Verify all hooks executable

2. `upgrade from Phase 14 works` (5 tests)
   - Start with Phase 14 state (simulated)
   - Add Phase 14.5 hooks
   - Verify no conflicts
   - Verify old hooks still work
   - Verify new hooks work

3. `config migration` (5 tests)
   - Old hooks.json format -> new
   - Missing fields handled gracefully
   - Schema validation passes
   - Version detection works
   - Rollback capability (backup exists)

Use temp directories to simulate upgrade scenarios.
  </action>
  <verify>node --test ~/.claude/scripts/hooks/regression/upgrade-path.test.js passes</verify>
  <done>14 upgrade path tests pass</done>
</task>

<task type="auto">
  <name>Task 4: Forward Compatibility Tests (Phase 15)</name>
  <files>~/.claude/scripts/hooks/regression/forward-compat.test.js</files>
  <action>
Create forward compatibility tests for Phase 15 (~15 tests):

**Test scenarios:**
1. `hook extension points` (5 tests)
   - Verify new hooks can be added to hooks.json
   - Verify matcher system extensible
   - Verify hook type system supports new types
   - Verify command execution pattern reusable
   - Verify input/output JSON schema flexible

2. `skill integration readiness` (5 tests)
   - Verify hooks can call skills (via skill pattern)
   - Verify skill results consumable by hooks
   - Verify tdd-workflow skill hookable
   - Verify verification-loop skill hookable
   - Verify coding-standards skill hookable

3. `GSD/claude-flow integration points` (5 tests)
   - Verify memory_store/retrieve pattern works
   - Verify session state extensible
   - Verify metrics export extensible
   - Verify QuestDB tables extensible
   - Verify mcp-client pattern reusable

Design tests to validate extension points without implementing Phase 15.
  </action>
  <verify>node --test ~/.claude/scripts/hooks/regression/forward-compat.test.js passes</verify>
  <done>15 forward compatibility tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] node --test ~/.claude/scripts/hooks/regression/phase13-compat.test.js passes
- [ ] node --test ~/.claude/scripts/hooks/regression/phase14-compat.test.js passes
- [ ] node --test ~/.claude/scripts/hooks/regression/upgrade-path.test.js passes
- [ ] node --test ~/.claude/scripts/hooks/regression/forward-compat.test.js passes
- [ ] All 4 test files created in regression/ directory
- [ ] Total ~59 regression tests added
</verification>

<success_criteria>
- All tasks completed
- ~59 regression tests written and passing
- Phase 13 API preserved
- Phase 14 baseline maintained (99% pass rate)
- Extension points validated for Phase 15
</success_criteria>

<output>
After completion, create `.planning/phases/14.6-hooks-integration-validation/14.6-02-SUMMARY.md`
</output>
