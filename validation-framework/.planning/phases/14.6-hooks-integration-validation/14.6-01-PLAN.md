---
phase: 14.6-hooks-integration-validation
plan: 01
type: execute
wave: 1
depends_on: ["14.5-08"]
files_modified:
  - ~/.claude/scripts/tests/e2e/session-lifecycle.test.js
  - ~/.claude/scripts/tests/e2e/gsd-workflow.test.js
  - ~/.claude/scripts/tests/e2e/multi-agent.test.js
  - ~/.claude/scripts/tests/e2e/validation-orchestrator.test.js
autonomous: true
---

<objective>
Create end-to-end integration tests for complete workflows.

Purpose: Verify hooks work correctly in real usage scenarios
Output: E2E test suite with 40+ tests
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14.6-hooks-integration-validation/14.6-RESEARCH.md
@.planning/phases/14.5-hooks-shared-port/14.5-08-SUMMARY.md

# Integration points to test:
# - Phase 13: ValidationOrchestrator
# - Phase 14: ECC base hooks
# - Phase 14.5: Advanced hooks
# - Phase 15: Skills (forward compatibility)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test infrastructure</name>
  <files>~/.claude/scripts/tests/e2e/test-harness.js</files>
  <action>
1. Create directory: `mkdir -p ~/.claude/scripts/tests/e2e`
2. Create test harness that:
   - Mocks Claude Code hook invocation
   - Captures hook output
   - Verifies side effects (files created, state saved)
   - Measures execution time
   - Isolates test state (temp directories)

3. Functions:
   - `invokeHook(hookPath, input, event)` - invoke hook
   - `assertOutput(actual, expected)` - compare output
   - `assertFileCreated(path)` - check file exists
   - `assertStateContains(key, value)` - check state
   - `cleanupTestState()` - reset after test
   - `mockEnvironment(vars)` - set env vars
  </action>
  <verify>node -e "require('$HOME/.claude/scripts/tests/e2e/test-harness')"</verify>
  <done>test-harness.js provides E2E testing infrastructure</done>
</task>

<task type="auto">
  <name>Task 2: Session lifecycle E2E tests</name>
  <files>~/.claude/scripts/tests/e2e/session-lifecycle.test.js</files>
  <action>
1. Test complete session lifecycle:

   a. New session start (10 tests):
      - session-start-tracker detects new session
      - Git state tracked
      - Previous insights injected
      - PM detection works
      - tips-injector adds context

   b. Tool usage (10 tests):
      - Safety hooks block dangerous commands
      - Safety hooks allow safe commands
      - Quality hooks detect changes
      - Metrics hooks track events

   c. Session end (10 tests):
      - session-analyzer produces summary
      - session-insights creates SSOT
      - Metrics persisted
      - State ready for next session

   d. Session resume (5 tests):
      - Previous state loaded
      - Insights injected correctly
      - Continuation vs new detected

2. Use test-harness for all tests
3. Clean state between tests
  </action>
  <verify>node --test ~/.claude/scripts/tests/e2e/session-lifecycle.test.js</verify>
  <done>35 session lifecycle tests pass</done>
</task>

<task type="auto">
  <name>Task 3: GSD workflow E2E tests</name>
  <files>~/.claude/scripts/tests/e2e/gsd-workflow.test.js</files>
  <action>
1. Test GSD workflow integration:

   a. Plan execution (8 tests):
      - task-checkpoint creates checkpoints
      - plan-validator validates structure
      - claudeflow-sync saves state
      - Errors don't break workflow

   b. Phase execution (6 tests):
      - Hooks fire correctly per wave
      - State persists between plans
      - SUMMARY triggers quality hooks

   c. Pause/Resume (4 tests):
      - session-insights captures state
      - Resume loads correct state
      - No data loss

   d. Verify-work (4 tests):
      - Quality hooks run validation
      - Metrics aggregated
      - Report generated

2. Mock GSD environment
3. Verify hook order
  </action>
  <verify>node --test ~/.claude/scripts/tests/e2e/gsd-workflow.test.js</verify>
  <done>22 GSD workflow tests pass</done>
</task>

<task type="auto">
  <name>Task 4: Multi-agent E2E tests</name>
  <files>~/.claude/scripts/tests/e2e/multi-agent.test.js</files>
  <action>
1. Test multi-agent coordination:

   a. File coordination (6 tests):
      - file-claim locks file
      - file-release unlocks
      - Conflict detection works
      - Stale claims timeout

   b. Task coordination (4 tests):
      - task-claim prevents duplicates
      - task-release works
      - Dead agent detection

   c. Hive management (4 tests):
      - Agent spawn tracked
      - Status updates work
      - Completion detected

   d. Shared state (4 tests):
      - Metrics aggregated correctly
      - No race conditions
      - State consistent

2. Simulate multiple agents (async)
3. Verify coordination works
  </action>
  <verify>node --test ~/.claude/scripts/tests/e2e/multi-agent.test.js</verify>
  <done>18 multi-agent tests pass</done>
</task>

<task type="auto">
  <name>Task 5: ValidationOrchestrator integration tests</name>
  <files>~/.claude/scripts/tests/e2e/validation-orchestrator.test.js</files>
  <action>
1. Test Phase 13 integration:

   a. PostToolUse â†’ Validator chain (5 tests):
      - post-tool-use triggers orchestrator
      - Tier 1 validators run
      - Results returned correctly

   b. Architecture validation (3 tests):
      - New component detected
      - ARCHITECTURE.md updated
      - Correct format

   c. README generation (3 tests):
      - Significant change detected
      - README suggestion made
      - Correct section identified

   d. CI autofix (4 tests):
      - CI failure detected
      - Fix suggested
      - Pattern matched correctly

2. Use actual ValidationOrchestrator from Phase 13
3. Verify integration works
  </action>
  <verify>node --test ~/.claude/scripts/tests/e2e/validation-orchestrator.test.js</verify>
  <done>15 ValidationOrchestrator tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] test-harness.js created and working
- [ ] session-lifecycle.test.js: 35 tests pass
- [ ] gsd-workflow.test.js: 22 tests pass
- [ ] multi-agent.test.js: 18 tests pass
- [ ] validation-orchestrator.test.js: 15 tests pass
- [ ] Total: 90+ E2E tests passing
</verification>

<success_criteria>
- 90+ E2E tests covering all integration points
- All critical paths tested
- No integration gaps identified
- Tests are maintainable and clear
</success_criteria>

<output>
After completion, create `.planning/phases/14.6-hooks-integration-validation/14.6-01-SUMMARY.md`
</output>
