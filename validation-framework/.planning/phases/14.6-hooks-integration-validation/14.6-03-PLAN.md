---
phase: 14.6-hooks-integration-validation
plan: 03
type: execute
wave: 2
depends_on: ["14.6-01", "14.6-02"]
files_modified:
  - ~/.claude/scripts/tests/performance/hook-benchmarks.js
  - ~/.claude/scripts/tests/reliability/error-recovery.test.js
  - ~/.claude/scripts/tests/reliability/concurrent.test.js
autonomous: true
---

<objective>
Performance and reliability testing for production confidence.

Purpose: Ensure hooks are fast, reliable, and handle errors gracefully
Output: Performance benchmarks + reliability tests (30+ tests)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14.6-hooks-integration-validation/14.6-RESEARCH.md

# Performance requirements:
# - Hook execution < 100ms (p95)
# - Memory usage < 50MB
# - No blocking on errors
# - Graceful degradation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create performance benchmark suite</name>
  <files>~/.claude/scripts/tests/performance/hook-benchmarks.js</files>
  <action>
1. Create directory: `mkdir -p ~/.claude/scripts/tests/performance`
2. Benchmark each hook category:

   a. Execution time benchmarks:
      - Measure p50, p95, p99 latency
      - Target: p95 < 100ms
      - Flag hooks exceeding limit

   b. Memory usage benchmarks:
      - Measure heap before/after
      - Target: < 50MB per hook
      - Detect memory leaks

   c. Startup time:
      - Cold start vs warm start
      - Module loading time
      - Cache effectiveness

3. Output format:
   ```
   Hook Performance Report
   =======================
   Hook                  p50    p95    p99    Memory   Status
   git-safety-check      12ms   45ms   78ms   12MB     ✓ PASS
   session-analyzer      89ms   156ms  234ms  48MB     ⚠ WARN (p95)
   ```

4. CI integration: exit 1 if any hook fails thresholds
  </action>
  <verify>node ~/.claude/scripts/tests/performance/hook-benchmarks.js --quick</verify>
  <done>Performance benchmarks run and report results</done>
</task>

<task type="auto">
  <name>Task 2: Error recovery tests</name>
  <files>~/.claude/scripts/tests/reliability/error-recovery.test.js</files>
  <action>
1. Create directory: `mkdir -p ~/.claude/scripts/tests/reliability`
2. Test error handling:

   a. Graceful degradation (6 tests):
      - Hook throws → exits 0, doesn't block
      - Invalid JSON input → exits 0
      - Missing file → exits 0
      - Network timeout → exits 0

   b. Error logging (4 tests):
      - Errors logged to debug file
      - Error rate tracked
      - Stack trace captured
      - No sensitive data in logs

   c. State recovery (4 tests):
      - Corrupted state file → reset to default
      - Missing state → initialize
      - Partial write → recover
      - Lock file stale → auto-cleanup

   d. Cascade prevention (4 tests):
      - One hook fails → others continue
      - Error doesn't propagate to Claude
      - Session continues normally
  </action>
  <verify>node --test ~/.claude/scripts/tests/reliability/error-recovery.test.js</verify>
  <done>18 error recovery tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Concurrent execution tests</name>
  <files>~/.claude/scripts/tests/reliability/concurrent.test.js</files>
  <action>
1. Test concurrent execution:

   a. Race condition tests (5 tests):
      - Multiple hooks same file → no corruption
      - Parallel state updates → consistent
      - Lock contention → resolved

   b. Multi-agent tests (4 tests):
      - 3 agents concurrent → coordination works
      - File locking → no conflicts
      - Task assignment → no duplicates

   c. Event ordering (3 tests):
      - PreToolUse before PostToolUse
      - Stop hooks run in order
      - Dependencies respected

   d. Resource cleanup (3 tests):
      - Temp files cleaned
      - Locks released on exit
      - Memory freed
  </action>
  <verify>node --test ~/.claude/scripts/tests/reliability/concurrent.test.js</verify>
  <done>15 concurrent execution tests pass</done>
</task>

<task type="auto">
  <name>Task 4: Stress tests</name>
  <files>~/.claude/scripts/tests/reliability/stress.test.js</files>
  <action>
1. Stress test scenarios:

   a. High volume (3 tests):
      - 100 rapid tool calls → no degradation
      - 1000 state updates → consistent
      - Large files → handled

   b. Long session (3 tests):
      - 4 hour session → stable
      - State file growth → bounded
      - Memory stable

   c. Edge cases (4 tests):
      - Empty input → handled
      - Huge input → bounded
      - Unicode → correct
      - Special characters → escaped

2. Report any failures or degradation
  </action>
  <verify>node --test ~/.claude/scripts/tests/reliability/stress.test.js</verify>
  <done>10 stress tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] hook-benchmarks.js reports all hooks < 100ms p95
- [ ] error-recovery.test.js: 18 tests pass
- [ ] concurrent.test.js: 15 tests pass
- [ ] stress.test.js: 10 tests pass
- [ ] No memory leaks detected
- [ ] All hooks handle errors gracefully
</verification>

<success_criteria>
- All hooks meet performance targets (p95 < 100ms)
- Memory usage bounded (< 50MB)
- Error recovery works in all scenarios
- Concurrent execution is safe
- 43 reliability tests passing
</success_criteria>

<output>
After completion, create `.planning/phases/14.6-hooks-integration-validation/14.6-03-SUMMARY.md`
</output>
