---
phase: 05-other-extensions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.claude/templates/validation/extensions/workflow/test_workflow_execution.py.j2
  - ~/.claude/templates/validation/extensions/workflow/test_node_connections.py.j2
  - ~/.claude/templates/validation/extensions/data/test_data_integrity.py.j2
  - ~/.claude/templates/validation/extensions/data/test_api_endpoints.py.j2
autonomous: true
---

<objective>
Create workflow and data domain extension templates for validation pipeline.

Purpose: Enable workflow projects (N8N_dev) and data projects (UTXOracle, LiquidationHeatmap) to validate workflow execution, node connectivity, data integrity, and API endpoints.
Output: Four Jinja2 templates in ~/.claude/templates/validation/extensions/{workflow,data}/
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Reference patterns:
- ~/.claude/templates/validation/smoke/test_imports.py.j2 (pytest template structure)
- ~/.claude/templates/validation/extensions/trading/test_paper_trading.py.j2 (extension template pattern)
- ~/.claude/templates/validation/config.schema.json (config variables: domain)

Prior phase patterns (from Phase 4 SUMMARY):
- @pytest.mark.{domain} decorator pattern
- Conditional Jinja2 blocks for domain filtering
- Fixture-based test setup
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test_workflow_execution.py.j2 (EXT-WORKFLOW-01)</name>
  <files>~/.claude/templates/validation/extensions/workflow/test_workflow_execution.py.j2</files>
  <action>
Create pytest template for workflow execution validation:

1. File header with project_name, domain Jinja2 variables
2. TestWorkflowExecution class with @pytest.mark.workflow decorator:
   - test_workflow_triggers: Verify workflow can be triggered via API
   - test_workflow_completes: Verify workflow runs to completion without error
   - test_workflow_output_structure: Verify workflow output matches expected schema
   - test_workflow_timeout_handling: Verify workflow respects timeout configuration
3. TestWorkflowErrorHandling class:
   - test_invalid_input_rejection: Verify malformed input rejected with clear error
   - test_missing_credentials_handled: Verify graceful error when credentials missing
   - test_retry_on_transient_failure: Verify retry logic for transient failures
4. Use conftest fixture pattern (workflow_client) for test setup
5. Template variables from config.json: project_name, domain (should be "workflow")
6. Add conditional block: only generate tests if domain == "workflow"

Follow existing smoke/trading template patterns.
  </action>
  <verify>python3 -c "from jinja2 import Template; Template(open('$HOME/.claude/templates/validation/extensions/workflow/test_workflow_execution.py.j2').read())"</verify>
  <done>Template parses without Jinja2 syntax errors, contains all test classes</done>
</task>

<task type="auto">
  <name>Task 2: Create test_node_connections.py.j2 (EXT-WORKFLOW-02)</name>
  <files>~/.claude/templates/validation/extensions/workflow/test_node_connections.py.j2</files>
  <action>
Create pytest template for workflow node connectivity tests:

1. File header with project_name, domain Jinja2 variables
2. TestNodeConnections class with @pytest.mark.workflow decorator:
   - test_nodes_reachable: Verify all configured nodes respond
   - test_node_credentials_valid: Verify node credentials authenticate
   - test_node_api_version: Verify node API version compatibility
   - test_node_rate_limits: Verify rate limit headers respected
3. TestNodeIntegration class:
   - test_node_to_node_data_flow: Verify data passes between connected nodes
   - test_parallel_node_execution: Verify parallel node execution completes
   - test_conditional_node_routing: Verify conditional branches execute correctly
4. Use conftest fixture pattern (node_client, workflow_nodes) for test setup
5. Template variables: project_name, domain
6. Add conditional: only generate if domain == "workflow"

Reference N8N workflow patterns for realistic test scenarios.
  </action>
  <verify>python3 -c "from jinja2 import Template; Template(open('$HOME/.claude/templates/validation/extensions/workflow/test_node_connections.py.j2').read())"</verify>
  <done>Template parses without Jinja2 syntax errors, contains all node test classes</done>
</task>

<task type="auto">
  <name>Task 3: Create test_data_integrity.py.j2 (EXT-DATA-01)</name>
  <files>~/.claude/templates/validation/extensions/data/test_data_integrity.py.j2</files>
  <action>
Create pytest template for data integrity validation:

1. File header with project_name, domain Jinja2 variables
2. TestDataIntegrity class with @pytest.mark.data decorator:
   - test_schema_validation: Verify data matches defined schema
   - test_required_fields_present: Verify required fields not null/empty
   - test_data_type_consistency: Verify field types match specification
   - test_referential_integrity: Verify foreign key relationships valid
3. TestDataQuality class:
   - test_no_duplicate_records: Verify primary keys unique
   - test_timestamps_sequential: Verify time series data ordered
   - test_values_within_bounds: Verify numeric values in expected ranges
   - test_string_format_compliance: Verify string fields match patterns (email, URL, etc.)
4. Use conftest fixture pattern (db_connection, test_dataset) for test setup
5. Template variables: project_name, domain
6. Add conditional: only generate if domain == "data"

Design for generic data validation applicable to UTXOracle, LiquidationHeatmap.
  </action>
  <verify>python3 -c "from jinja2 import Template; Template(open('$HOME/.claude/templates/validation/extensions/data/test_data_integrity.py.j2').read())"</verify>
  <done>Template parses without Jinja2 syntax errors, contains all data integrity test classes</done>
</task>

<task type="auto">
  <name>Task 4: Create test_api_endpoints.py.j2 (EXT-DATA-02)</name>
  <files>~/.claude/templates/validation/extensions/data/test_api_endpoints.py.j2</files>
  <action>
Create pytest template for API endpoint validation:

1. File header with project_name, domain Jinja2 variables
2. TestAPIEndpoints class with @pytest.mark.data decorator:
   - test_health_endpoint: Verify /health returns 200
   - test_api_authentication: Verify auth required endpoints reject unauthenticated
   - test_rate_limiting: Verify rate limit headers present and enforced
   - test_response_format: Verify JSON responses match API spec
3. TestAPICRUD class:
   - test_list_endpoint: Verify GET /resource returns paginated list
   - test_get_by_id: Verify GET /resource/:id returns single item
   - test_create_endpoint: Verify POST /resource creates item
   - test_update_endpoint: Verify PUT /resource/:id updates item
   - test_delete_endpoint: Verify DELETE /resource/:id removes item
4. TestAPIErrorHandling class:
   - test_404_for_missing_resource: Verify proper 404 response
   - test_400_for_invalid_input: Verify validation error response format
   - test_500_error_format: Verify server errors don't leak internals
5. Use conftest fixture pattern (api_client, auth_token) for test setup
6. Template variables: project_name, domain
7. Add conditional: only generate if domain == "data"

Design for generic REST API testing applicable to data-serving projects.
  </action>
  <verify>python3 -c "from jinja2 import Template; Template(open('$HOME/.claude/templates/validation/extensions/data/test_api_endpoints.py.j2').read())"</verify>
  <done>Template parses without Jinja2 syntax errors, contains all API test classes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All four .j2 files exist in ~/.claude/templates/validation/extensions/{workflow,data}/
- [ ] All templates parse without Jinja2 syntax errors
- [ ] Templates reference correct config variables (project_name, domain)
- [ ] pytest templates follow existing smoke/trading patterns
- [ ] Conditional domain filtering works correctly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No Jinja2 syntax errors
- Templates integrate with existing config.schema.json structure
</success_criteria>

<output>
After completion, create `.planning/phases/05-other-extensions/05-01-SUMMARY.md`
</output>
