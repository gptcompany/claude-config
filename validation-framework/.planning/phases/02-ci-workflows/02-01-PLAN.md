---
phase: 02-ci-workflows
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.claude/templates/validation/ci/smoke-tests.yml.j2
  - ~/.claude/templates/validation/ci/integration-tests.yml.j2
autonomous: true
---

<objective>
Create GitHub Actions workflow templates for smoke and integration tests.

Purpose: Provide reusable CI templates that projects can scaffold with one command.
Output: Two Jinja2 templates in ~/.claude/templates/validation/ci/
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-framework/01-01-PLAN.md

Reference patterns:
- /media/sam/1TB/nautilus_dev/.github/workflows/ci-cd-pipeline.yml (6-stage pipeline)
- ~/.claude/templates/validation/config.schema.json (config structure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create smoke-tests.yml.j2 (CI-01)</name>
  <files>~/.claude/templates/validation/ci/smoke-tests.yml.j2</files>
  <action>
Create GitHub Actions workflow template for smoke tests:

1. Workflow name: "Smoke Tests"
2. Triggers: push to main/develop, pull_request to main
3. Single job "smoke" with:
   - runs-on: ubuntu-latest
   - timeout-minutes: {{ ci.smoke_timeout_minutes | default(5) }}
   - Steps:
     - actions/checkout@v4
     - actions/setup-python@v5 with python-version: {{ ci.python_version | default("3.12") }}
     - Install UV: pip install uv
     - Install deps: uv sync --frozen
     - Run smoke tests: uv run pytest tests/smoke -v -m smoke --timeout=120 --junitxml=smoke-results.xml
     - Upload results: actions/upload-artifact@v4

Template variables from config.json:
- {{ project_name }} — for workflow naming
- {{ ci.smoke_timeout_minutes }} — job timeout
- {{ ci.python_version }} — Python version

Use Jinja2 defaults for optional values.
  </action>
  <verify>
python3 -c "
import jinja2
env = jinja2.Environment()
template = env.from_string(open('$HOME/.claude/templates/validation/ci/smoke-tests.yml.j2').read())
# Validate template syntax
print('Template valid')
"
  </verify>
  <done>smoke-tests.yml.j2 exists, valid Jinja2 syntax, uses config variables</done>
</task>

<task type="auto">
  <name>Task 2: Create integration-tests.yml.j2 (CI-02)</name>
  <files>~/.claude/templates/validation/ci/integration-tests.yml.j2</files>
  <action>
Create GitHub Actions workflow template for integration tests:

1. Workflow name: "Integration Tests"
2. Triggers: push to main/develop, pull_request to main
3. Job "integration" with:
   - runs-on: ubuntu-latest
   - timeout-minutes: {{ ci.test_timeout_minutes | default(10) }}
   - Services (optional, based on domain):
     {% if domain == "trading" %}
     - redis: redis:7-alpine
     {% endif %}
     {% if domain == "data" %}
     - postgres: postgres:15-alpine
     {% endif %}
   - Steps:
     - actions/checkout@v4
     - actions/setup-python@v5
     - Install UV and deps
     - Run integration tests: uv run pytest tests/integration -v --timeout=300 --junitxml=integration-results.xml
     - Upload results

Template variables:
- {{ project_name }}
- {{ domain }} — determines which services to include
- {{ ci.test_timeout_minutes }}
- {{ ci.python_version }}

Domain-specific services:
- trading: redis (for caching)
- data: postgres (for data pipelines)
- workflow: none by default
- general: none by default
  </action>
  <verify>
python3 -c "
import jinja2
env = jinja2.Environment()
template = env.from_string(open('$HOME/.claude/templates/validation/ci/integration-tests.yml.j2').read())
print('Template valid')
"
  </verify>
  <done>integration-tests.yml.j2 exists, valid Jinja2 syntax, domain-aware services</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both .j2 files exist in ~/.claude/templates/validation/ci/
- [ ] Templates parse without Jinja2 syntax errors
- [ ] Templates reference config variables correctly
- [ ] Generated YAML would be valid GitHub Actions syntax
</verification>

<success_criteria>
- All tasks completed
- Both CI templates created
- Templates use config.json variables (project_name, ci.*, domain)
- No Jinja2 syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-ci-workflows/02-01-SUMMARY.md`
</output>
