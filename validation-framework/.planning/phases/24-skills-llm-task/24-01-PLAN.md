---
phase: 24-skills-llm-task
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /home/sam/moltbot-infra/clawdbot-config/openclaw.json
  - /home/sam/moltbot-infra/clawd-workspace/skills/tdd-cycle/SKILL.md
  - /home/sam/moltbot-infra/clawd-workspace/skills/validate-review/SKILL.md
autonomous: false
---

<objective>
Configure llm-task plugin with cross-model routing, create TDD-cycle and validate-review workspace skills, and install Lobster for typed workflow pipelines.

Purpose: Enable Bambam agents to use cross-model review (Gemini for review, Claude for coding), TDD-native skills, and Lobster pipeline automation — completing the skills & LLM Task layer of v7.0.
Output: Updated openclaw.json with llm-task config, 2 new workspace skills, Lobster installed in container.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-skills-llm-task/24-RESEARCH.md
@.planning/phases/21-models-providers/21-01-SUMMARY.md
@.planning/phases/23-hooks-webhooks/23-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure llm-task plugin + create TDD-cycle skill</name>
  <files>/home/sam/moltbot-infra/clawdbot-config/openclaw.json, /home/sam/moltbot-infra/clawd-workspace/skills/tdd-cycle/SKILL.md</files>
  <action>
1. **llm-task config** — Update `plugins.entries.llm-task` in openclaw.json:
   ```json
   {
     "enabled": true,
     "defaultProvider": "google",
     "defaultModel": "gemini-2.5-pro",
     "allowedModels": ["google/gemini-2.5-pro", "openai/gpt-5.2"],
     "maxTokens": 2000,
     "timeoutMs": 60000
   }
   ```
   This excludes Claude from llm-task to prevent self-review anti-pattern.

2. **Add `lobster` to tools allow list** for all 4 agents (main, nautilus, utxoracle, n8n). The `llm_task` tool is already in allow list (Phase 21).

3. **Create TDD-cycle skill** at `/home/sam/moltbot-infra/clawd-workspace/skills/tdd-cycle/SKILL.md`:
   - name: `tdd-cycle`
   - Gating: `requires.bins: ["python3", "pytest"]`
   - user-invocable: true
   - Instructions: RED-GREEN-REFACTOR cycle with pytest, ending with validation orchestrator run (tier 1 quick)
   - Keep skill prompt concise (<500 tokens) to minimize system prompt bloat

All changes via SSH to muletto (openclaw.json) and workstation (workspace skills).
  </action>
  <verify>
- `ssh 192.168.1.100 'cat /home/sam/moltbot-infra/clawdbot-config/openclaw.json' | python3 -m json.tool` — valid JSON
- `ssh 192.168.1.100 'cat /home/sam/moltbot-infra/clawdbot-config/openclaw.json' | python3 -c "import sys,json; c=json.load(sys.stdin); print(c['plugins']['entries']['llm-task']['allowedModels'])"` — shows google + openai models
- `ls /home/sam/moltbot-infra/clawd-workspace/skills/tdd-cycle/SKILL.md` — file exists
  </verify>
  <done>llm-task configured with Gemini default + Claude excluded. TDD-cycle skill created with pytest gating.</done>
</task>

<task type="auto">
  <name>Task 2: Install Lobster + create validate-review workflow skill</name>
  <files>/home/sam/moltbot-infra/clawd-workspace/skills/validate-review/SKILL.md</files>
  <action>
1. **Install Lobster in gateway container:**
   ```bash
   ssh 192.168.1.100 'docker exec openclaw-gateway npm install -g @openclaw/lobster'
   ```
   Verify with `lobster --version`. If npm global install doesn't persist (ephemeral container), add install command to docker-compose entrypoint or create a startup script.

2. **Create validate-review skill** at `/home/sam/moltbot-infra/clawd-workspace/skills/validate-review/SKILL.md`:
   - name: `validate-review`
   - Gating: `requires.bins: ["python3", "lobster"]`
   - user-invocable: true
   - Instructions: Run validation orchestrator tier 1, then pipe results to llm-task for cross-model review (Gemini), output structured JSON with score + issues

3. **Create .lobster workflow file** at `/home/sam/moltbot-infra/clawd-workspace/workflows/validate-and-review.lobster`:
   - Step 1: Run `python3 ~/.claude/templates/validation/orchestrator.py 1` (tier 1 quick)
   - Step 2: Pipe validation output to llm-task with JSON schema (score, issues array)
   - Step 3: Approval gate if score < 70

Note: If Lobster is NOT available (npm package doesn't exist or install fails), skip the .lobster file and make the validate-review skill invoke llm-task directly via the agent's built-in tool. Document this as a deviation.
  </action>
  <verify>
- `ssh 192.168.1.100 'docker exec openclaw-gateway lobster --version'` — version printed (or document fallback)
- `ls /home/sam/moltbot-infra/clawd-workspace/skills/validate-review/SKILL.md` — file exists
  </verify>
  <done>Lobster installed (or fallback documented). validate-review skill created with cross-model review pipeline.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>llm-task configured, 2 new skills (tdd-cycle, validate-review), Lobster installed</what-built>
  <how-to-verify>
    1. SSH muletto: `ssh 192.168.1.100`
    2. Restart gateway: `cd /home/sam/moltbot-infra && docker compose up -d openclaw-gateway`
    3. Doctor check: `docker exec openclaw-gateway node /app/dist/entry.js doctor`
    4. Skills list: `docker exec openclaw-gateway node /app/dist/entry.js skills list`
       - Confirm: tdd-cycle and validate-review appear
    5. llm-task test: In Bambam, run `/tdd-cycle` on a simple test — verify skill loads
    6. Check logs: `docker logs openclaw-gateway --tail 30` — no errors
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] openclaw.json valid JSON with llm-task config
- [ ] llm-task excludes Claude from allowedModels (no self-review)
- [ ] lobster in tools allow list for all agents
- [ ] tdd-cycle skill has pytest gating
- [ ] validate-review skill has lobster gating (or fallback documented)
- [ ] Gateway restart successful
- [ ] Skills appear in `skills list`
</verification>

<success_criteria>

- All tasks completed
- llm-task routes to Gemini by default for cross-model review
- TDD-cycle skill available and invocable
- Validation-review pipeline functional
- No config errors from `openclaw doctor`
</success_criteria>

<output>
After completion, create `.planning/phases/24-skills-llm-task/24-01-SUMMARY.md`
</output>
