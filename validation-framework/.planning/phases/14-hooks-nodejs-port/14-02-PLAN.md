---
phase: 14-hooks-nodejs-port
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - ~/.claude/scripts/hooks/session-start.js
  - ~/.claude/scripts/hooks/session-end.js
  - ~/.claude/scripts/hooks/pre-compact.js
autonomous: true
---

<objective>
Port ECC's critical session hooks: session-start, session-end, and pre-compact.

Purpose: Core session lifecycle management - context persistence across sessions.
Output: Three Node.js hook scripts (~200 LOC)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-hooks-nodejs-port/14-RESEARCH.md
@.planning/phases/14-hooks-nodejs-port/14-01-SUMMARY.md

# ECC Reference (port from):
# /media/sam/1TB/everything-claude-code/scripts/hooks/session-start.js (61 LOC)
# /media/sam/1TB/everything-claude-code/scripts/hooks/session-end.js (82 LOC)
# /media/sam/1TB/everything-claude-code/scripts/hooks/pre-compact.js (48 LOC)

# Uses:
# ~/.claude/scripts/lib/utils.js (from 14-01)
# ~/.claude/scripts/lib/package-manager.js (from 14-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create hooks directory and port session-start.js</name>
  <files>~/.claude/scripts/hooks/session-start.js</files>
  <action>
1. Create directory: `mkdir -p ~/.claude/scripts/hooks`
2. Port ECC's session-start.js
3. Hook behavior:
   - Check for recent session files (last 7 days) in `~/.claude/sessions/`
   - Report number of sessions found and latest path
   - Check for learned skills in `~/.claude/skills/learned/`
   - Detect package manager and report
   - Show selection prompt if PM not configured
4. Use relative require: `require('../lib/utils')`
5. Follow graceful degradation: `process.exit(0)` even on error
6. Add shebang: `#!/usr/bin/env node`
  </action>
  <verify>node ~/.claude/scripts/hooks/session-start.js</verify>
  <done>session-start.js runs, outputs session count and package manager</done>
</task>

<task type="auto">
  <name>Task 2: Port session-end.js</name>
  <files>~/.claude/scripts/hooks/session-end.js</files>
  <action>
1. Port ECC's session-end.js from `/media/sam/1TB/everything-claude-code/scripts/hooks/session-end.js`
2. Hook behavior:
   - Read stdin JSON input (session data)
   - Save session state to `~/.claude/sessions/` with timestamp
   - Log session duration if available
   - Clean up old session files (>30 days)
3. Use readStdinJson from utils.js for input
4. Graceful degradation on errors
  </action>
  <verify>echo '{"session_id":"test"}' | node ~/.claude/scripts/hooks/session-end.js</verify>
  <done>session-end.js runs with piped input, creates session file</done>
</task>

<task type="auto">
  <name>Task 3: Port pre-compact.js</name>
  <files>~/.claude/scripts/hooks/pre-compact.js</files>
  <action>
1. Port ECC's pre-compact.js from `/media/sam/1TB/everything-claude-code/scripts/hooks/pre-compact.js`
2. Hook behavior (PreCompact event):
   - Save current context/state before compaction
   - Store in `~/.claude/compaction-state/` with timestamp
   - Log what was saved
3. This is a safety net - context can be recovered if compaction loses important info
4. Graceful degradation on errors
  </action>
  <verify>echo '{}' | node ~/.claude/scripts/hooks/pre-compact.js</verify>
  <done>pre-compact.js runs, creates compaction state file</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `~/.claude/scripts/hooks/session-start.js` exists and runs
- [ ] `~/.claude/scripts/hooks/session-end.js` exists and handles piped input
- [ ] `~/.claude/scripts/hooks/pre-compact.js` exists and handles piped input
- [ ] All three hooks exit 0 (no blocking)
- [ ] Hooks create files in appropriate directories
</verification>

<success_criteria>

- Three session lifecycle hooks ported
- All hooks use utils.js library
- All hooks follow graceful degradation pattern
- Hooks create appropriate session/state files
</success_criteria>

<output>
After completion, create `.planning/phases/14-hooks-nodejs-port/14-02-SUMMARY.md`
</output>
