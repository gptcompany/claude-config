---
phase: 14-hooks-nodejs-port
plan: 05
type: execute
wave: 3
depends_on: ["14-02", "14-03", "14-04"]
files_modified:
  - .github/workflows/hooks-ci.yml
  - ~/.claude/scripts/lib/utils.test.js
autonomous: true
---

<objective>
Test the hooks system cross-platform with GitHub Actions CI.

Purpose: Verify hooks work identically on Linux and macOS.
Output: CI workflow that tests hooks on both platforms
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-hooks-nodejs-port/14-RESEARCH.md
@.planning/phases/14-hooks-nodejs-port/14-02-SUMMARY.md
@.planning/phases/14-hooks-nodejs-port/14-03-SUMMARY.md
@.planning/phases/14-hooks-nodejs-port/14-04-SUMMARY.md

# Files to test:
# ~/.claude/scripts/lib/utils.js
# ~/.claude/scripts/lib/package-manager.js
# ~/.claude/scripts/hooks/*.js
# ~/.claude/hooks/hooks.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive test suite</name>
  <files>~/.claude/scripts/lib/utils.test.js, ~/.claude/scripts/lib/package-manager.test.js</files>
  <action>
1. Expand utils.test.js to cover all functions:
   - Platform detection (isWindows/isMacOS/isLinux - at least one should be true)
   - Directory functions (getHomeDir, getClaudeDir return valid paths)
   - Date functions (format validation)
   - File operations (ensureDir creates, readFile/writeFile roundtrip)
   - Hook I/O (log, output work without error)
   - System (commandExists('node') === true)
2. Create package-manager.test.js:
   - PACKAGE_MANAGERS has npm/pnpm/yarn/bun
   - getPackageManager returns object with name, config, source
   - getRunCommand returns valid command strings
   - getCommandPattern returns valid regex
3. Use Node.js built-in test runner
4. Tests should pass on both Linux and macOS

DO NOT use mocks for file operations - test with real temp files.
  </action>
  <verify>node --test ~/.claude/scripts/lib/*.test.js</verify>
  <done>All utils and package-manager tests pass locally</done>
</task>

<task type="auto">
  <name>Task 2: Create hooks test script</name>
  <files>~/.claude/scripts/test-hooks.js</files>
  <action>
1. Create test-hooks.js that validates all hooks:
   - Verify hooks.json is valid JSON
   - Verify all referenced scripts exist
   - Run each hook script with test input
   - Verify hooks exit 0 (graceful degradation)
2. Test input scenarios:
   - Empty stdin: `echo '{}' | node hook.js`
   - Valid tool input: `echo '{"tool_name":"Edit"}' | ...`
   - Invalid JSON (should not crash): `echo 'invalid' | ...`
3. Report pass/fail for each hook
4. Exit 0 only if all hooks pass

This is the integration test for the complete hooks system.
  </action>
  <verify>node ~/.claude/scripts/test-hooks.js</verify>
  <done>test-hooks.js validates all hooks and reports results</done>
</task>

<task type="auto">
  <name>Task 3: Create GitHub Actions CI workflow</name>
  <files>~/.claude/scripts/.github/workflows/hooks-ci.yml</files>
  <action>
1. Create workflow file for hooks testing
2. Matrix strategy: ubuntu-latest, macos-latest
3. Steps:
   - Checkout (note: hooks are in ~/.claude, need to copy)
   - Setup Node.js 20
   - Copy hooks to runner home directory
   - Run unit tests: `node --test lib/*.test.js`
   - Run integration tests: `node test-hooks.js`
4. Trigger: push to main, PR, manual dispatch
5. Artifact: Upload test results

Note: Windows is out of scope for this phase (Phase 16 if needed).
  </action>
  <verify>cat ~/.claude/scripts/.github/workflows/hooks-ci.yml | head -20</verify>
  <done>CI workflow exists with Linux + macOS matrix</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] utils.test.js covers all major functions
- [ ] package-manager.test.js covers detection and commands
- [ ] test-hooks.js validates all hooks
- [ ] hooks-ci.yml has matrix for ubuntu + macos
- [ ] All tests pass locally on Linux
- [ ] CI workflow is syntactically valid YAML
</verification>

<success_criteria>

- Comprehensive test suite for utils.js and package-manager.js
- Integration test for all hooks
- CI workflow ready for cross-platform testing
- All tests pass on Linux locally
</success_criteria>

<output>
After completion, create `.planning/phases/14-hooks-nodejs-port/14-05-SUMMARY.md`
</output>
