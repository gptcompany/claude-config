---
phase: 25-gemini-cross-review
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
---

<objective>
Verify end-to-end Gemini cross-model review pipeline: validate that GEMINI_API_KEY works in the gateway container, llm-task routes to Gemini 2.5 Pro correctly, and validate-review skill produces structured cross-model review output.

Purpose: Enable Gemini as independent cross-model reviewer — Claude should not review its own code.
Output: Verified working Gemini cross-review pipeline, documented in SUMMARY.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-gemini-cross-review/25-RESEARCH.md
@.planning/phases/21-models-providers/21-01-SUMMARY.md
@.planning/phases/24-skills-llm-task/24-01-SUMMARY.md

GEMINI_API_KEY is already present in the gateway container on muletto (192.168.1.100).
The previous research noted a 403 error — this plan verifies if that's resolved or still present.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify GEMINI_API_KEY validity in container</name>
  <files>None (verification only)</files>
  <action>
    1. Confirm key is in container:
       ```bash
       ssh 192.168.1.100 'docker exec openclaw-gateway printenv GEMINI_API_KEY | wc -c'
       ```
       Should return >10.

    2. Test key validity from inside container (avoids host env issues):
       ```bash
       ssh 192.168.1.100 'docker exec openclaw-gateway sh -c "curl -s \"https://generativelanguage.googleapis.com/v1beta/models?key=\${GEMINI_API_KEY}\" | head -5"'
       ```
       If 200 + model list: key is valid, proceed.
       If 403: key still invalid — document and create checkpoint for user to generate new key.

    3. Check which Gemini models are available in free tier:
       ```bash
       ssh 192.168.1.100 'docker exec openclaw-gateway sh -c "curl -s \"https://generativelanguage.googleapis.com/v1beta/models?key=\${GEMINI_API_KEY}\" | python3 -c \"import sys,json; [print(m[\\\"name\\\"]) for m in json.loads(sys.stdin.read()).get(\\\"models\\\",[])]\" 2>/dev/null"'
       ```
       Confirm gemini-2.5-pro and gemini-2.5-flash are listed.
  </action>
  <verify>Key present in container (wc -c > 10) AND curl returns model list (not 403)</verify>
  <done>GEMINI_API_KEY validity confirmed, available models documented.</done>
</task>

<task type="auto">
  <name>Task 2: E2E test llm-task → Gemini routing</name>
  <files>None (verification only)</files>
  <action>
    1. Test llm-task with Gemini provider:
       ```bash
       ssh 192.168.1.100 'docker exec openclaw-gateway node /app/dist/entry.js agent \
         --agent main --session-id gemini-verify-$(date +%s) \
         --message "Use the llm-task tool with provider google, model gemini-2.5-pro, and prompt: Respond with exactly one word: GEMINI_OK" \
         --json --timeout 120'
       ```
       Verify response contains "GEMINI_OK" or similar confirmation.

    2. If step 1 fails with 403 or provider error, try with gemini-2.5-flash as fallback:
       ```bash
       ssh 192.168.1.100 'docker exec openclaw-gateway node /app/dist/entry.js agent \
         --agent main --session-id gemini-flash-$(date +%s) \
         --message "Use the llm-task tool with provider google, model gemini-2.5-flash, and prompt: Respond with exactly one word: FLASH_OK" \
         --json --timeout 120'
       ```

    3. Test validate-review skill (the real use case):
       ```bash
       ssh 192.168.1.100 'docker exec openclaw-gateway node /app/dist/entry.js agent \
         --agent main --session-id review-e2e-$(date +%s) \
         --message "Run the validate-review skill on this sample: def add(a, b): return a + b" \
         --json --timeout 180'
       ```
       Verify structured review output with score from non-Claude model.

    4. Document results: which model responded, latency, any errors.
  </action>
  <verify>
    - llm-task routes to Gemini successfully (response received)
    - validate-review skill produces structured review from cross-model reviewer
  </verify>
  <done>Gemini cross-review pipeline verified E2E: agent → llm-task → Gemini 2.5 Pro → structured review.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] GEMINI_API_KEY present and valid in container
- [ ] llm-task with google/gemini-2.5-pro returns response
- [ ] validate-review skill produces structured cross-model review
- [ ] Latency and any limitations documented
</verification>

<success_criteria>

- GEMINI_API_KEY works (not 403)
- Cross-model review pipeline operational E2E
- validate-review skill uses Gemini as independent reviewer
- Results documented in SUMMARY
</success_criteria>

<output>
After completion, create `.planning/phases/25-gemini-cross-review/25-01-SUMMARY.md`
</output>
